<!DOCTYPE html>
<html>
  <head>
    <title>WebAR Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam;">

      <a-entity camera gps-camera rotation-reader></a-entity>

      <script>
        const urlParams = new URLSearchParams(window.location.search);
        const data = JSON.parse(decodeURIComponent(urlParams.get('data') || '[]'));

        data.forEach(obj => {
          const entity = document.createElement('a-entity');
          entity.setAttribute('gps-entity-place', `latitude: ${obj.latitude}; longitude: ${obj.longitude};`);
          entity.setAttribute('gltf-model', obj.file_url);
          entity.setAttribute('scale', '10 10 10');
          entity.setAttribute('look-at', '[gps-camera]');
          document.querySelector('a-scene').appendChild(entity);

          const text = document.createElement('a-text');
          text.setAttribute('value', obj.title);
          text.setAttribute('look-at', '[gps-camera]');
          text.setAttribute('scale', '10 10 10');
          text.setAttribute('position', '0 2 0');
          entity.appendChild(text);
        });
      </script>

    </a-scene>
  </body>
</html>
