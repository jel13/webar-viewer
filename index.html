<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebAR from Firestore</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- A-Frame + AR.js -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; gpsMinAccuracy: 100; gpsTimeInterval: 1000;"
    >
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      // ✅ Your Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyB8sohC94FQQWAHLl1MFB5d9ZJ5UXiz2wc",
        authDomain: "bacootrip.firebaseapp.com",
        projectId: "bacootrip",
        storageBucket: "bacootrip.appspot.com",
        messagingSenderId: "750857744363",
        appId: "1:750857744363:web:76f5c5d79d00dc318bf3ae"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // ✅ Fetch AR objects from Firestore
      db.collection("ar_objects")
        .get()
        .then((snapshot) => {
          snapshot.forEach((doc) => {
            const data = doc.data();

            if (!data.file_url || !data.latitude || !data.longitude) return;

            const entity = document.createElement("a-entity");

            entity.setAttribute("gltf-model", data.file_url);
            entity.setAttribute(
              "gps-entity-place",
              `latitude: ${data.latitude}; longitude: ${data.longitude};`
            );
            entity.setAttribute("scale", "2 2 2");
            entity.setAttribute("animation-mixer", "");
            entity.setAttribute("look-at", "[gps-camera]");

            document.querySelector("a-scene").appendChild(entity);
          });
        })
        .catch((error) => {
          console.error("Error fetching AR objects:", error);
        });
    </script>
  </body>
</html>
